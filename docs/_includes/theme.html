{% comment %}
Include this right at the start of body to be loaded as fast as possible to avoid a FOUC
{% endcomment %}
<script>
    (function () {
        var forceSetting = localStorage.getItem("forceDarkModeOn");
        var browserPrefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        var darkModeEnabled = forceSetting === "true" || (!forceSetting && browserPrefersDark);

        if (browserPrefersDark) {
            document.body.classList.toggle("theme-system", darkModeEnabled);
            document.body.classList.toggle("theme-dark", false);
        }
        else {
            document.body.classList.toggle("theme-system", true);
            document.body.classList.toggle("theme-dark", darkModeEnabled);
        }

        var highContrastTheme = localStorage.getItem("highContrastTheme");

        if (highContrastTheme === "true") {
            document.body.classList.add("theme-highcontrast");
        } else {
            document.body.classList.remove("theme-highcontrast");
        }

        var rainbowTheme = localStorage.getItem("rainbowTheme");

        if(rainbowTheme === "true") {
            document.body.classList.add("theme-rainbow");

            var rotation = 0;
            var speed = 5;

            window.rainbowId = setInterval(() => {
                document.documentElement.style.setProperty('--theme-primary-color-h', (rotation++ * speed) % 360);
            }, 10)
        } else {
            document.body.classList.remove("theme-rainbow");
        }

        var dyslexicTheme = localStorage.getItem("dyslexicTheme");

        if (dyslexicTheme === "true") {
            document.body.classList.add("theme-dyslexic");
        } else {
            document.body.classList.remove("theme-dyslexic");
        }

        var customTheme = localStorage.getItem("customTheme");

        if (customTheme === "true") {
            document.body.classList.add("theme-custom");
        } else {
            document.body.classList.remove("theme-custom");
        }

        var spacingDefaultTheme = localStorage.getItem("spacingDefaultTheme");

        if (spacingDefaultTheme === "true") {
            document.body.classList.remove("theme-spacing-l theme-spacing-xl");
        }

        var spacingLargeTheme = localStorage.getItem("spacingLargeTheme");

        if (spacingLargeTheme === "true") {
            document.body.classList.add("theme-spacing-l");
            document.body.classList.remove("theme-spacing-xl");
        }

        var spacingExtraLargeTheme = localStorage.getItem("spacingExtraLargeTheme");

        if (spacingExtraLargeTheme === "true") {
            document.body.classList.add("theme-spacing-xl");
            document.body.classList.remove("theme-spacing-l");
        }

        var fontDefaultTheme = localStorage.getItem("fontDefaultTheme");

        if (fontDefaultTheme === "true") {
            document.body.classList.remove("theme-font-l theme-font-xl");
            document.html.classList.remove("theme-font-l theme-font-xl");
        }

        var fontLargeTheme = localStorage.getItem("fontLargeTheme");

        if (fontLargeTheme === "true") {
            document.body.classList.add("theme-font-l");
            document.body.classList.remove("theme-font-xl");
            document.html.classList.add("theme-font-l");
            document.html.classList.remove("theme-font-xl");
        }

        var fontExtraLargeTheme = localStorage.getItem("fontExtraLargeTheme");

        if (fontExtraLargeTheme === "true") {
            document.body.classList.add("theme-font-xl");
            document.body.classList.remove("theme-font-l");
            document.html.classList.add("theme-font-xl");
            document.html.classList.remove("theme-font-l");
        }
    }());
</script>