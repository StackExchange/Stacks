@import (reference) "../exports/_stacks-exports.less";
// TODO why is local less.js not finding these automatically?
@import (reference) "../atomic/_stacks-typography.less";
@import (reference) "../atomic/_stacks-misc.less";
@import (reference) "../atomic/_stacks-width-height.less";
@import (reference) "../atomic/_stacks-borders.less";

// forced light topbar
.s-topbar__light {
    --theme-topbar-background-color: @black-025;

    // Search input
    --theme-topbar-search-color: @black-700;
    --theme-topbar-search-background: @white;
    --theme-topbar-search-placeholder: @black-200;
    --theme-topbar-search-border: @black-200;
    --theme-topbar-search-border-focus: @blue-300;
    --theme-topbar-search-shadow-focus: 0 0 0 @su4 fade(@blue-500, 15%);

    // Search switcher
    --theme-topbar-select-color: @black-700;
    --theme-topbar-select-background: @black-050;

    // topbar items
    --theme-topbar-item-color: @black-600;
    --theme-topbar-item-color-hover: @black-800;
    --theme-topbar-item-background-hover: @black-075;
    --theme-topbar-item-color-current: @black;
    --theme-topbar-item-border-current: var(--theme-primary-color);
}

// forced dark topbar
.s-topbar__dark {
    @topbar-actual-background: @black-800;
    // TODO
    #calc-topbar-lightness-increase() when (lightness(@topbar-actual-background) < 15%) {
        @topbar-search-lightness-increase: 20%;
    }
    #calc-topbar-lightness-increase() when not (lightness(@topbar-actual-background) < 15%) {
        @topbar-search-lightness-increase: 10%;
    }
    #calc-topbar-lightness-increase();

    --theme-topbar-background-color: @topbar-actual-background;
    // Search input
    --theme-topbar-search-color: lighten(@topbar-actual-background, 80% + @topbar-search-lightness-increase);
    --theme-topbar-search-background: lighten(@topbar-actual-background, @topbar-search-lightness-increase);
    --theme-topbar-search-placeholder: lighten(@topbar-actual-background, 60% + @topbar-search-lightness-increase);
    --theme-topbar-search-border: lighten(@topbar-actual-background, @topbar-search-lightness-increase);
    --theme-topbar-search-border-focus: lighten(@topbar-actual-background, 45% + @topbar-search-lightness-increase);
    --theme-topbar-search-shadow-focus: 0 0 0 @su4 fade(@white, 30%);

    // Search switcher
    --theme-topbar-select-color: lighten(@topbar-actual-background, 60% + @topbar-search-lightness-increase);
    --theme-topbar-select-background: lighten(@topbar-actual-background, 10% + @topbar-search-lightness-increase);

    // topbar items
    --theme-topbar-item-color: @black-025;
    --theme-topbar-item-color-hover: @white;
    --theme-topbar-item-background-hover: @black-700;
    --theme-topbar-item-color-current: @white;
    --theme-topbar-item-border-current: var(--theme-primary-color);

    // themed border accent
    --theme-topbar-accent-border: none;
}

.s-topbar {
    min-width: auto;
    box-shadow: var(--bs-sm);
    width: 100%;
    z-index: @zi-navigation-fixed;
    background-color: var(--theme-topbar-background-color);
    height: var(--topbar-height);
    display: flex;
    border-top: var(--theme-topbar-accent-border);
    position: relative;

    // Wraps the content so the topbar stretches 100% w/ content at some value below that
    .s-topbar--container {
        width: @s-full; // wmx12; Consumers should use atomic classes to override this
        max-width: 100%;
        display: flex;
        margin: 0 auto;
    }

    .s-topbar--logo {
        padding: 0 @su8;
        height: 100%;
        display: flex;
        align-items: center;
        background-color: transparent;
    }

    a.s-topbar--logo:hover {
        background-color: var(--theme-topbar-item-background-hover);
    }

    a.s-topbar--logo.is-selected {
        background-color: var(--theme-topbar-item-background-hover);
    }

    .s-topbar--menu {
        display: flex;// none;
        padding: 0;
        height: 100%;
        width: 44px;
        flex-shrink: 0;
        align-items: center;
        justify-content: center;

        // NOTE: taken from source file
        // build hamburger icon manually instead of using `@Svg` helper because
        // we can more easily animate its content (transform hamburger into x)
        span {
            width: 18px;
            height: 2px;
            background-color: var(--theme-topbar-item-color);
            position: relative;

            &:before,
            &:after {
                position: absolute;
                content: '';
                width: 18px;
                height: 2px;
                left: 0;
                background: var(--theme-topbar-item-color);
                top: -5px;
                transition: all ease-in-out 0.1s;
            }

            &:after {
                top: 5px;
            }
        }

        // Transforming hamburger into x
        &.is-selected {
            color: var(--theme-topbar-item-color-current);
            background-color: var(--theme-topbar-item-background-current);

            span {
                background-color: transparent;

                &:before,
                &:after {
                    top: 0;
                    transform: rotate(-45deg);
                }

                &:after { transform: rotate(45deg); }
            }
        }

        &:hover {
            color: var(--theme-topbar-item-color-hover);
            background-color: var(--theme-topbar-item-background-hover);
        }
    }
}

.s-topbar .s-topbar--navigation,
.s-topbar .s-topbar--content,
.s-topbar .s-topbar--ctas {
    display: flex;
    height: 100%;
    .list-reset;

    // TODO cleanup
    > li {
        display: inline-flex;
    }
}

.s-topbar .s-topbar--navigation,
.s-topbar .s-topbar--content {
    .s-topbar--item {
        color: var(--theme-topbar-item-color);
        display: inline-flex;
        align-items: center;
        padding: 0 10px; // TODO @su8 or @su12?
        text-decoration: none;
        white-space: nowrap;
        position: relative;

        &:hover,
        &:focus,
        &.is-selected,
        &.is-selected:hover,
        &.is-selected:focus {
            color: var(--theme-topbar-item-color-hover);
            background-color: var(--theme-topbar-item-background-hover);
            text-decoration: none;
            outline: none;

            .s-activity-indicator {
                top: 6px;
            }
        }

        .svg-icon {
            vertical-align: text-top;
        }

        .s-activity-indicator {
            position: absolute;
            top: 10px;
            right: 2px;
            transition: top @te-smooth 0.15s;
        }
    }
}

// Primary navigation: Links to products on the left
.s-topbar .s-topbar--navigation {
    .s-topbar--item {
        display: inline-block;
        padding: @su4 + @su2 @su16;
        border-radius: 1000px;
        align-self: center;

        &.is-selected {
            background-color: var(--theme-primary-color);
            color: var(--white);

            &:hover,
            &:focus {
                background-color: var(--theme-primary-600);
                color: var(--white);
            }
        }
    }

    // TODO Stacks component? Badge?
    .s-topbar--item.s-topbar--notice {
        border-radius: @br-sm;
        font-weight: bold;
        font-size: @fs-fine;
        text-transform: uppercase;
        padding: @su4 @su8;
        margin: 0 @su8;

        &.is-unread {
            background-color: var(--theme-primary-color);
            color: var(--white);

            &:hover,
            &:focus {
                background-color: var(--theme-primary-600);
                color: var(--white);
            }
        }
    }
}

// Secondary navigation: CTAs & icons on the right.
.s-topbar .s-topbar--content {
    // allow this content to scroll if it gets too long
    .overflow-x-auto;
    // push this section as far to the right as possible
    margin-left: auto;
}

// CTAs: Sign in, Sign up, etc. on the far right
.s-topbar .s-topbar--ctas {
    padding-left: @su4;
    padding-right: @su8;
    // push this section as far to the right as possible
    margin-left: auto;

    li + li {
        margin-left: @su4;
    }

    .s-topbar--item {
        align-self: center;
        padding-top: @su8;
        padding-bottom: @su8;
    }
}

// Searchbar
.s-topbar .s-topbar--searchbar {
    @inputLineHeights: @lh-sm; // ensure the line heights between the two elements match up

    -webkit-transform: translate3d(0, 0, 0); // Solves an issue with Safari clipping things strangely when a popover is present in the topbar
    padding: 0 @su8;
    display: flex;
    align-items: center;
    flex-shrink: 10000; // force the searchbar to shrink as much as possible if there's no extra space
    flex-grow: 1; //...but allow it to grow if there *is* extra space

    .s-topbar--searchbar--input-group {
        position: relative;
        flex-grow: 1;

        .s-input {
            border-color: var(--theme-topbar-search-border);
            background-color: var(--theme-topbar-search-background);
            box-shadow: var(--theme-topbar-search-shadow);
            color: var(--theme-topbar-search-color);
            line-height: @inputLineHeights;

            &:focus {
                border-color: var(--theme-topbar-search-border-focus);
                box-shadow: var(--theme-topbar-search-shadow-focus);
            }

            &::placeholder {
                color: var(--theme-topbar-search-placeholder);
                font-style: normal;
            }
        }
    }

    .s-select {
        .wmx2;

        margin-right: -1px;
        color: var(--theme-topbar-select-color);

        &:before,
        &:after {
            z-index: @zi-active; // Make sure our focus ring is above the search input
        }
    }

    .s-select > select {
        .brr0;
        height: 100%;
        line-height: @inputLineHeights;

        border-color: var(--theme-topbar-search-border);
        background-color: var(--theme-topbar-select-background);
        color: var(--theme-topbar-select-color);

        &:focus {
            border-color: var(--theme-topbar-search-border-focus);
            box-shadow: var(--theme-topbar-search-shadow-focus);
            z-index: @zi-selected;
        }
    }

    // drop the left border of the search input when it is next to the select
    .s-select + .s-topbar--searchbar--input-group > .s-input {
        .blr0;
    }

    #stacks-internals #screen-sm({
        display: none;
        position: absolute;
        left: 0;
        right: 0;
        top: 100%;
        max-width: 100%;
        padding: @su8 @su12;
        background: var(--theme-topbar-item-background-hover);

        &.s-topbar--searchbar__open {
            display: flex;
            max-width: none;
        }

        .s-select {
            .w25;
        }
    });
}
