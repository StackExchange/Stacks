.s-input,
.s-textarea {
    --_in-bc: var(--bc-darker);
    --_in-bg: var(--white);
    --_in-br: var(--br-sm);
    --_in-c: unset;
    --_in-fc: var(--fc-dark);
    --_in-fs: var(--fs-body1);
    --_in-o: unset;
    --_in-px: 0.7em;
    --_in-py: 0.6em;
    --_in-webkit-ph-fc: var(--black-200);

    // CONTEXTUAL STYLES
    @supports (-webkit-overflow-scrolling: touch) {
        --_in-fs: var(--su-static16); // 16px â€” Increase font size for mobile safari. This keeps our inputs from zooming the page while focused.
        --_in-px: 0.55em;
        --_in-py: 0.36em;

        &::-webkit-input-placeholder {
            line-height: normal !important;
        }
    }
    .highcontrast-mode({
        --_in-placeholder-fc: var(--black-400);

        &[readonly],
        .is-readonly & {
            --_in-fc: var(--fc-light);
        }
    });
    &[disabled],
    &[readonly],
    .is-readonly & {
        --_in-c: not-allowed;
    }
    &[readonly],
    .is-readonly & { // [1]
        --_in-bg: var(--black-050);
        --_in-bc: var(--bc-light);
        --_in-fc: var(--black-200);
    }
    &[disabled] {
        --_in-o: var(--_o-disabled-static);
    }

    // MODIFIERS
    &&__sm {
        --_in-fs: var(--fs-caption);
    }
    &&__md {
        @supports (-webkit-overflow-scrolling: touch) {
            --_in-fs: 17px;
            --_in-py: 0.4em;
        }

        --_in-br: calc(var(--br-sm) + 1px);
        --_in-fs: var(--fs-body3);
    }
    &&__lg {
        --_in-br: calc(var(--br-sm) + 1px);
        --_in-fs: var(--fs-title);
        --_in-px: 0.6em;
        --_in-py: 0.45em;
    }
    &&__xl {
        --_in-br: var(--br-md);
        --_in-fs: var(--fs-headline1);
        --_in-px: 0.5em;
        --_in-py: 0.4em;
    }

    // CHILD ELEMENTS
    &::placeholder,
    &::-webkit-input-placeholder {
        color: var(--_in-webkit-ph-fc);
    }
    &::placeholder {
        opacity: 1;
    }
    &:-webkit-autofill {
        &:focus {
            border-color: var(--blue-300);
            // Since the box shadow is overwritten to show a background, we have to re-add the focus outline
            -webkit-box-shadow: 0 0 0 1000px var(--blue-050) inset, 0 0 0 var(--su-static4) var(--focus-ring);
        }

        -webkit-box-shadow: 0 0 0 1000px var(--theme-secondary-050) inset; // This acts as a background color by stretching an inset box shadow across the input
        -webkit-text-fill-color: var(--black);
        border-color: var(--blue-300);
        transition: background-color 0s 50000s; // A hack to infinitely delay background styles that come from the browser.

    }
    &::-webkit-contacts-auto-fill-button {
        background-color: var(--black); // In Safari, make the autocomplete button darkmode-aware
    }
    &&__creditcard,
    &&__search {
        --_in-pl: var(--su-static32);
    }

    // INTERACTION
    &:focus{
        @input-focus-style();
    }

    @scrollbar-styles();
    background-color: var(--_in-bg);
    border: var(--su-static1) solid var(--_in-bc);
    border-radius: var(--_in-br);
    color: var(--_in-fc);
    cursor: var(--_in-c);
    font-size: var(--_in-fs);
    opacity: var(--_in-o);
    padding: var(--_in-py) var(--_in-px) var(--_in-py) var(--_in-pl, var(--_in-px));

    -webkit-appearance: none; // Removes shadows we don't want in mobile Safari
    font-family: inherit;
    margin: 0; // A guard against Core's default margins
    width: 100%;
}
.s-input {
    &:focus-within { // [2]
        @input-focus-style();
    }
    &&__md {
        --_in-py: 0.5em;
    }
}
.s-textarea {
    &&__md {
        --_in-py: 0.72em;
    }
}

// Other input-related elements
.s-input-fill {
    --_if-bc: var(--bc-darker);
    --_if-bg: var(--black-050);
    --_if-blw: 0;
    --_if-blr: unset;
    --_if-brr: unset;
    --_if-brw: 0;

    &&__clear {
        --_if-bc: transparent;
        --_if-bg: transparent;
    }
    &.order-first {
        --_if-blw: var(--su-static1);
        --_if-blr: var(--br-sm);
    }
    &.order-last {
        --_if-brw: var(--su-static1);
        --_if-brr: var(--br-sm);
    }

    background-color: var(--_if-bg);
    border: var(--su-static1) solid var(--_if-bc);
    border-left-width: var(--_if-blw);
    border-radius: var(--_if-blr) var(--_if-brr) var(--_if-brr) var(--_if-blr);
    border-right-width: var(--_if-brw);

    color: var(--fc-medium);
    font-family: inherit;
    line-height: var(--lh-sm);
    padding: 0.6em 0.7em;
    white-space: nowrap;
}
.s-input-icon {
    --_ii-r: 0.7em;

    &&__creditcard,
    &&__search {
        --_ii-r: auto;

        color: var(--black-400);
        left: 0.7em;
    }

    right: var(--_ii-r);

    margin-top: -9px; // Half the icon's height at 18px for centering;
    pointer-events: none;
    position: absolute;
    top: 50%;
}
.s-input-message {
    font-size: var(--fs-caption);
    padding: var(--su2);
}

fieldset { // TODO move to standalone file
    &[disabled] {
        a,
        .s-btn,
        .s-link {
            box-shadow: none !important;
            opacity: var(--_o-disabled-static);
            pointer-events: none;
        }

        .s-checkbox,
        .s-input,
        .s-input-message,
        .s-radio,
        .s-select > select,
        .s-textarea,
        .s-toggle-switch,
        .s-toggle-switch label {
            cursor: not-allowed;
            opacity: var(--_o-disabled-static);
        }
    }

    border: 0;
    min-width: 0;
    padding: 0;
}

.is-disabled,
.is-readonly,
.has-success,
.has-error,
.has-warning { // TODO move to standalone file (global-state.less?)
    .s-input {
        padding-right: var(--su32);
    }
    .s-input-message a {
        text-decoration: underline;
    }
    .s-select .s-input-icon {
        right: var(--su32);
    }
    .s-textarea {
        ~ .s-input-icon {
            top: 1.5em;
            right: 1.5em;
        }

        padding-right: var(--su48);
    }

    position: relative;
}

.has-warning { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--yellow-600);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-warning);
        }
    }
    .s-input-icon {
        color: var(--yellow-600);
    }
    .s-input-message {
        a {
            color: var(--yellow-900);
        }

        color: var(--yellow-800);
    }
}
.has-error { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--red-400);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-error);
        }
    }
    .s-input-message {
        color: var(--red-500);

        a {
            color: var(--red-800);

            &:hover {
                color: var(--red-900);
            }
        }
    }
    .s-input-icon {
        color: var(--red-400);
    }
}
.has-success { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--green-400);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-success);
        }
    }

    .s-input-message {
        color: var(--green-500);

        a {
            color: var(--green-800);

            &:hover {
                color: var(--green-900);
            }
        }
    }

    .s-input-icon {
        color: var(--green-400);
    }
}
.is-disabled { // TODO move to standalone file (global-state.less?)
    .s-select:before,
    .s-select:after {
        border-color: var(--bc-darker) transparent;
    }
    .s-input-icon {
        color: var(--black-400);
    }
}
.is-readonly { // TODO move to standalone file (global-state.less?)
    .s-input-icon {
        .highcontrast-mode({
            color: var(--fc-light);
        });

        color: var(--black-200);
    }
}

//  [1] The readonly attribute is not supported on select elements
//      See https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/readonly
//      and https://github.com/StackExchange/Stacks/pull/1040#discussion_r931144086

//  [2] This needs to be separate from the other references @input-focus-style,
//      because in browsers that don't support :focus-within it's a syntax error,
//      rendering the whole selector null and void.