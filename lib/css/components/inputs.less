.s-input,
.s-textarea {
    --_in-br: var(--br-sm);
    --_in-fs: var(--fs-body1);
    --_in-px: 0.7em;
    --_in-py: 0.6em;
    --_in-webkit-ph-fc: var(--black-200);

    // CONTEXTUAL STYLES
    @supports (-webkit-overflow-scrolling: touch) {
        --_in-fs: var(--su-static16); // 16px â€” Increase font size for mobile safari. This keeps our inputs from zooming the page while focused.
        --_in-px: 0.55em;
        --_in-py: 0.36em;

        &::-webkit-input-placeholder {
            line-height: normal !important;
        }
    }
    .highcontrast-mode({
        --_in-placeholder-fc: var(--black-400);
    });

    // MODIFIERS
    &&__sm {
        --_in-fs: var(--fs-caption);
    }
    &&__md {
        @supports (-webkit-overflow-scrolling: touch) {
            --_in-fs: 17px;
            --_in-py: 0.4em;
        }

        --_in-br: calc(var(--br-sm) + 1px);
        --_in-fs: var(--fs-body3);
    }
    &&__lg {
        --_in-br: calc(var(--br-sm) + 1px);
        --_in-fs: var(--fs-title);
        --_in-px: 0.6em;
        --_in-py: 0.45em;
    }
    &&__xl {
        --_in-br: var(--br-md);
        --_in-fs: var(--fs-headline1);
        --_in-px: 0.5em;
        --_in-py: 0.4em;
    }

    // CHILD ELEMENTS
    &::placeholder,
    &::-webkit-input-placeholder {
        color: var(--_in-webkit-ph-fc);
    }
    &::placeholder {
        opacity: 1;
    }
    &:-webkit-autofill {
        &:focus {
            border-color: var(--blue-300);
            // Since the box shadow is overwritten to show a background, we have to re-add the focus outline
            -webkit-box-shadow: 0 0 0 1000px var(--blue-050) inset, 0 0 0 var(--su-static4) var(--focus-ring);
        }

        -webkit-box-shadow: 0 0 0 1000px var(--theme-secondary-050) inset; // This acts as a background color by stretching an inset box shadow across the input
        -webkit-text-fill-color: var(--black);
        border-color: var(--blue-300);
        transition: background-color 0s 50000s; // A hack to infinitely delay background styles that come from the browser.

    }
    &::-webkit-contacts-auto-fill-button {
        background-color: var(--black); // In Safari, make the autocomplete button darkmode-aware
    }
    &&__creditcard,
    &&__search {
        --_in-pl: var(--su-static32);
    }

    @scrollbar-styles();
    border-radius: var(--_in-br);
    font-size: var(--_in-fs);
    padding: var(--_in-py) var(--_in-px) var(--_in-py) var(--_in-pl, var(--_in-px));

    -webkit-appearance: none; // Removes shadows we don't want in mobile Safari
    background-color: var(--white);
    border: var(--su-static1) solid var(--bc-darker);
    color: var(--fc-dark);
    font-family: inherit;
    margin: 0; // A guard against Core's default margins
    width: 100%;
}
.s-input {
    &&__md {
        --_in-py: 0.5em;
    }
}
.s-textarea {
    &&__md {
        --_in-py: 0.72em;
    }
}

// Other input-related elements
.s-input-fill {
    --_if-bc: var(--bc-darker);
    --_if-bg: var(--black-050);
    --_if-blw: 0;
    --_if-blr: unset;
    --_if-brr: unset;
    --_if-brw: 0;

    &&__clear {
        --_if-bc: transparent;
        --_if-bg: transparent;
    }
    &.order-first {
        --_if-blw: var(--su-static1);
        --_if-blr: var(--br-sm);
    }
    &.order-last {
        --_if-brw: var(--su-static1);
        --_if-brr: var(--br-sm);
    }

    background-color: var(--_if-bg);
    border: var(--su-static1) solid var(--_if-bc);
    border-left-width: var(--_if-blw);
    border-radius: var(--_if-blr) var(--_if-brr) var(--_if-brr) var(--_if-blr);
    border-right-width: var(--_if-brw);

    color: var(--fc-medium);
    font-family: inherit;
    line-height: var(--lh-sm);
    padding: 0.6em 0.7em;
    white-space: nowrap;
}
.s-input-icon {
    --_ii-r: 0.7em;

    &&__creditcard,
    &&__search {
        --_ii-r: auto;

        color: var(--black-400);
        left: 0.7em;
    }

    right: var(--_ii-r);

    margin-top: -9px; // Half the icon's height at 18px for centering;
    pointer-events: none;
    position: absolute;
    top: 50%;
}
.s-input-message {
    font-size: var(--fs-caption);
    padding: var(--su2);
}

fieldset { // TODO move to standalone file
    &[disabled] {
        a,
        .s-btn,
        .s-link {
            box-shadow: none !important;
            opacity: var(--_o-disabled-static);
            pointer-events: none;
        }

        .s-checkbox,
        .s-input,
        .s-input-message,
        .s-radio,
        .s-select > select,
        .s-textarea,
        .s-toggle-switch,
        .s-toggle-switch label {
            cursor: not-allowed;
            opacity: var(--_o-disabled-static);
        }
    }

    border: 0;
    min-width: 0;
    padding: 0;
}

// TODO would _love_ to use .s-check instead, with no class on the input itself
.s-check-control { // TOOD move to standalone file check.less
    .s-label {
        [disabled] + & {
            &:extend(.is-disabled .s-label);
        }

        font-weight: normal;
    }

    align-items: center;
    display: flex;
    gap: var(--su8);
}

.s-check-group { // TOOD move to standalone file checks-radios.less
    display: flex;
    flex-direction: column;
    gap: var(--su8);

    &&__horizontal {
        flex-direction: row;
    }

    // TODO HACK? <legend> isn't respecting gap...
    legend.s-label {
        margin-bottom: var(--su8);
    }

    // manually align the checkboxes and radios to the top of the group
    .s-check-control {
        align-items: flex-start;
    }
    .s-checkbox, .s-radio {
        margin-top: calc(var(--su2) + var(--su1)); // 3px
    }
}

.s-checkbox,
.s-radio { // TOOD move to standalone file checks-radios.less
    //  [1]   Check to see if we can use custom styles, if so reset the defaults
    //  ------------------------------------------------------------------------
    @supports ((-webkit-appearance: none) or (-moz-appearance: none) or (appearance: none)) {
        .appearance(none);

        &::-ms-check {
            display: none;
        }

        //  [2]  Now re-style the checkboxes and radios
        //  ------------------------------------------------------------------------
        margin: 0; // A guard against Core's default margins
        width: 1em;
        height: 1em;
        border: 1px solid var(--bc-darker);
        background-color: var(--white);
        outline: 0;
        font-size: inherit;
        vertical-align: middle;
        cursor: pointer;
    }

    //  Disabled
    &[disabled] {
        opacity: var(--_o-disabled-static);
        cursor: not-allowed;
    }
}

//  $$  CHECKBOXES
//  ----------------------------------------------------------------------------
.s-checkbox { // TOOD move to standalone file checks-radios.less
    @supports ((-webkit-appearance: none) or (-moz-appearance: none) or (appearance: none)) {
        border-radius: var(--br-sm);
        background-position: center center;
        background-repeat: no-repeat;
        background-size: contain;

        &:checked, &:indeterminate {
            border-color: var(--theme-secondary-400) !important;
            background-color: var(--theme-secondary-400);

            .highcontrast-dark-mode({
                border-color: var(--blue-700) !important;
                background-color: var(--blue-300);
            });

            &:focus {
                border-color: var(--theme-secondary-400);
            }
        }

        &:checked {
            background-image: url("data:image/svg+xml,%3Csvg width='11' height='11' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 3.41L8.59 2 4 6.59 2.41 5 1 6.41l3 3z' fill='%23fff'/%3E%3C/svg%3E");
        }
        &:indeterminate {
            background-image: url("data:image/svg+xml,%3Csvg width='11' height='11' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 4.5 h7 v2 h-7 z' fill='%23fff'/%3E%3C/svg%3E");
        }

        &:focus {
            border-color: var(--theme-secondary-300);
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring);
        }
    }
}

//  $$  RADIOS
//  ----------------------------------------------------------------------------
.s-radio { // TOOD move to standalone file checks-radios.less
    @supports ((-webkit-appearance: none) or (-moz-appearance: none) or (appearance: none)) {
        border-radius: var(--br-circle);

        &:checked {
            border-color: var(--theme-secondary-400);
            border-width: 0.30769231em;
            background-color: @white; // This should always be white regardless of dark mode

            .highcontrast-dark-mode({
                border-color: var(--blue-300);
                outline: 1px solid var(--black);
            });
        }

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring);
        }
    }
}

& { // TODO figure out what this is doing
    @focus-style: {
        border-color: var(--theme-secondary-300);
        box-shadow: 0 0 0 var(--su-static4) var(--focus-ring);
        color: var(--black);
        outline: 0;

        .highcontrast-mode({
            border-color: var(--black);
        })
    }

    .s-input:focus,
    .s-input.has-focus,
    .s-textarea:focus,
    .s-select > select:focus {
        @focus-style();
    }

    // This needs to be separate from the one above, because in browsers that don't support :focus-within
    // it's a syntax error, rendering the whole selector null and void.
    .s-input:focus-within {
        @focus-style();
    }
}

.s-input,
.s-textarea {
    &[disabled],
    &[readonly],
    .is-readonly & {
        cursor: not-allowed;
    }
    //  Readonly
    //  Note: The readonly attribute is not supported on select elements
    //  See https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/readonly
    //  and https://github.com/StackExchange/Stacks/pull/1040#discussion_r931144086
    &[readonly],
    .is-readonly & {
        .highcontrast-mode({
            color: var(--fc-light);
        });

        background-color: var(--black-050);
        border-color: var(--bc-light);
        color: var(--black-200);
        cursor: not-allowed;
    }
    &[disabled] {
        opacity: var(--_o-disabled-static);
    }
}

.is-disabled,
.is-readonly,
.has-success,
.has-error,
.has-warning { // TODO move to standalone file (global-state.less?)
    .s-input {
        padding-right: var(--su32);
    }
    .s-input-message a {
        text-decoration: underline;
    }
    .s-select .s-input-icon {
        right: var(--su32);
    }
    .s-textarea {
        ~ .s-input-icon {
            top: 1.5em;
            right: 1.5em;
        }

        padding-right: var(--su48);
    }

    position: relative;
}

.has-warning { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--yellow-600);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-warning);
        }
    }
    .s-input-icon {
        color: var(--yellow-600);
    }
    .s-input-message {
        a {
            color: var(--yellow-900);
        }

        color: var(--yellow-800);
    }
}
.has-error { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--red-400);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-error);
        }
    }
    .s-input-message {
        color: var(--red-500);

        a {
            color: var(--red-800);

            &:hover {
                color: var(--red-900);
            }
        }
    }
    .s-input-icon {
        color: var(--red-400);
    }
}
.has-success { // TODO move to standalone file (global-state.less?)
    .s-input,
    .s-textarea,
    .s-checkbox,
    .s-radio:not(:checked),
    .s-select > select {
        border-color: var(--green-400);

        &:focus {
            box-shadow: 0 0 0 var(--su-static4) var(--focus-ring-success);
        }
    }

    .s-input-message {
        color: var(--green-500);

        a {
            color: var(--green-800);

            &:hover {
                color: var(--green-900);
            }
        }
    }

    .s-input-icon {
        color: var(--green-400);
    }
}
.is-disabled { // TODO move to standalone file (global-state.less?)
    .s-select:before,
    .s-select:after {
        border-color: var(--bc-darker) transparent;
    }
    .s-input-icon {
        color: var(--black-400);
    }
}
.is-readonly { // TODO move to standalone file (global-state.less?)
    .s-input-icon {
        .highcontrast-mode({
            color: var(--fc-light);
        });

        color: var(--black-200);
    }
}
